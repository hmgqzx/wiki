[TOC]

# Testing

## Test as You Write the Code

### 边界测试

* Test code at its boundaries.
  * 例如：`non-existent` or `empty` input，a `single` input item, an exactly `full` array, and so on.
  * 这个观点是：大部分错误会出现在边界上，如果在边界上都可以通过测试，那么其余地方一般来说不会有什么问题
  * Boundary condition checking is effective for finding `off-by-one errors`.


### Test pre- and post-conditions

to verify that expected or necessary properties hold before (pre-condition) and after (post-condition) some piece of code executes.

`pre-condition` 即某段代码执行前的条件是否满足，如输入合法性

`post-condition` 即该段代码执行后的性质，是否符合预期

### Use `assertions`

断言对于检查 `Interface` 的性质比较有用

### Program defensively

给程序进行防御，加入代码去处理某些“非预期”情况

### Check `error` returns

One often-overlooked defense is to check the `error` returns from `library functions` and `system calls`. Return values from input routines such as `fread` and `fscanf `should always be checked for errors, as should any file open call such as `fopen`.

## Systematic Testing

测试要形成一个系统化的流程，有秩序地做，就不会忽略掉某些东西，同时要做记录📝，看到了哪一步

### Test incrementally

测试和写程序应该同步进行，而不是一股脑写出程序后再来测试。写出一点，测试一点。两个组件（已单独通过各自的测试），连接起来后也测试一下，看他们能否合在一起正常工作

### Test simple parts first

Tests should focus first on the simplest and most commonly executed features of a program; only when those are working properly should you move on.

### 这样进行测试

1. 边界条件测试
2. 系统化测试各种小情况，从简单到复杂
3. 即使测试集很小（用手工完成也容易），也应该写`测试代码`（调用待测试片段）来自动化


#### 测试二分搜索的例子

以下情况是 边界条件测试 + 系统测试各小情况，按复杂性排列如下：

* search an array with `no` elements 
* search an array with `one` element and a trial value that is 
  * less than the single element in the array 
  * equal to the single element 
  * greater than the single element 
* search an array with `two` elements and trial values that
  * check all five possible positions 
* check behavior with `duplicate` elements in the array and trial values
  * less than the value in the array 
  * equal to the value 
  * greater than the value 
* search an array with `three` elements as with two elements 
* search an array with `four` elements as with two and three


以上情况虽然很简单，但是用手工的方式也会很烦的。所以还是写自动化测试代码来完成的好。

## Test Automation

### Automate regression testing

`regression testing` 是指 performs a sequence of tests that **compare** the new version of something with the previous version. 因为在每一次修改后，要保证除了有意做出的修改，程序的其余行为仍和以前一样

可利用脚本语言来写

注意回归测试含有一个隐含假定，那就是认为之前的版本产生的输出是正确的。所以要周期性回来检查一下之前的版本本身的输出，保证可靠性一直延续下去

### Create self-contained tests

`self-contained tests` 自带测试过程中的 输入实例 和 期望输出

为此，我们需写程序来自动生成这些输入和输出

## Test Scaffolds

测试台

先搞出一个简单的版本（可能效率很低下，但是可以保证输出是对的），得到期望输入。再利用这些来测试可能还有错误的高效版本。

## Stress Tests

`Higher volume` in itself tends to break things

People tend to avoid "impossible" cases like `empty` inputs or input that is `out of` order or out of range, and are unlikely to create very `long` names or `huge` data values.

在手头保存一批这样的测试文件，或是能生成它们的代码

## Tips for Testing



## Testing the Markov Program

测试边界条件

verified conservation properties （某些恒定的特征）

statistical test（统计必须自然合理）

自动化：用一个脚本（这里用来 Awk）产生必需的输入数据，运行测试并对它们计时，打印出反常的输出



